name: test_PBaSR_SRFormer
suffix: ~  # add suffix to saved images
model_type: SRFormerParaTestModel
scale: 4
num_gpu: 2  # set num_gpu: 0 for cpu mode
manual_seed: 0
is_train: false

datasets:
  val_1:
    name: DIV2K
    type: PairedImageDataset
    dataroot_gt: # HR dir path here
    dataroot_lq: # LR dir path here
    io_backend:
      type: disk
  
  val_2:
    name: ReBlurSR_Defocus
    type: PairedImageBFDataset
    dataroot_gt: # HR dir path here
    dataroot_lq: # LR dir path here
    dataroot_blur_mask: # mask dir path here
    io_backend:
      type: disk
  
  val_3:
    name: ReBlurSR_Motion
    type: PairedImageBFDataset
    dataroot_gt: # HR dir path here
    dataroot_lq: # LR dir path here
    dataroot_blur_mask: # mask dir path here
    io_backend:
      type: disk


# network structures
network_g:
  type: ParallelNet_ncb
  general_branch_parameter:
    type: SRFormer
    upscale: 4
    in_chans: 3
    img_size: 64
    window_size: 22
    img_range: 1.0
    depths: [6, 6, 6, 6, 6, 6]
    embed_dim: 180
    num_heads: [6, 6, 6, 6, 6, 6]
    mlp_ratio: 2
    upsampler: nearest+conv
    resi_connection: 1conv
  defocus_branch_parameter:
    type: SRFormer
    upscale: 4
    in_chans: 3
    img_size: 64
    window_size: 22
    img_range: 1.0
    depths: [6, 6, 6, 6, 6, 6]
    embed_dim: 180
    num_heads: [6, 6, 6, 6, 6, 6]
    mlp_ratio: 2
    upsampler: nearest+conv
    resi_connection: 1conv
  general_pretrained_weight_path: ~
  defocus_pretrained_weight_path: ~

# path
path:
  pretrain_network_g: # PBaSR_SRFormer's pretrained weight
  strict_load: true
  strict_load_g: true
  param_key_g: params

val:
  val_freq: !!float 1000
  save_img: true
  suffix: ~
  log_average_loss_in_val: false
  val_each_iter: false

  key_metric: lpips
  metrics:
    psnr:
      type: psnr 
      crop_border: 4
      test_y_channel: true
    ssim:
      type: ssim 
      crop_border: 4
      test_y_channel: true
    lpips:
      type: lpips 
      better: lower